# Session Log: 2026-01-11

## Summary
Completed ADR-009 GRF Browser Stage 2: File Dialog & Korean Font Support

## What Was Accomplished

### 1. File Dialog Implementation
- Added native file dialog using `github.com/sqweek/dialog`
- Implemented pending path pattern to handle macOS main thread requirements
- File > Open GRF menu now works correctly

### 2. Korean Font Support
- Implemented font loading with `SetAfterCreateContextHook`
- Custom glyph ranges for Korean (Hangul Syllables 0xAC00-0xD7AF)
- Cross-platform font detection (macOS: Arial Unicode.ttf, Windows: malgun.ttf, Linux: NotoSansCJK)

### 3. Critical Bug Fix: EUC-KR Encoding
- **Problem**: Korean filenames displayed as garbled "占쏙옙占쏙옙" characters
- **Root Cause**: `strings.ToLower()` in `pkg/grf/grf.go` was corrupting EUC-KR bytes by treating them as invalid UTF-8 and replacing with U+FFFD
- **Solution**: Implemented `asciiToLower()` that only lowercases ASCII A-Z while preserving high bytes for proper EUC-KR to UTF-8 conversion
- Korean filenames now display correctly (e.g., "유저인터페이스", "아이템")

### 4. CI Updates
- Added `libgtk-3-dev` to CI dependencies for Linux builds (required by dialog package)
- Fixed lint issues (goimports, gofmt, misspelling)

## Files Changed
- `cmd/grfbrowser/main.go` - File dialog, Korean font loading
- `pkg/grf/grf.go` - asciiToLower() fix for EUC-KR
- `docs/adr/ADR-009-grf-browser-tool.md` - Updated Stage 2 progress
- `.github/workflows/ci.yml` - Added GTK+3 dependency
- `go.mod`, `go.sum` - Added dialog dependency

## PR
- PR #22: feat(grfbrowser): add file dialog and Korean font support (ADR-009 Stage 2)
- Status: Merged

## Stage 2 Remaining Items
- [ ] Recent files list in File menu
- [ ] Search history dropdown

## Next Steps
- Start Stage 3: Sprite Viewer
  - SPR loading and texture creation
  - Single frame display
  - Frame navigation
  - ACT loading
  - Animation playback

## Debug Notes
- F12 captures screenshots to `/tmp/grfbrowser/`
- Ctrl+D dumps state to `/tmp/grfbrowser/state.json`
- State dump shows expanded paths and selected file in JSON format
